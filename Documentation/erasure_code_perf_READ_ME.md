# API Documentation for erasure_code_perf.c

## Overview
This document details the functionality and usage of the `erasure_code_perf.c` file. The software is developed for high-performance erasure coding, which is widely used for data recovery in distributed storage systems.

## License
This software is provided by Intel Corporation and Michael H. Anderson for non-commercial evaluation purposes only. Redistribution and usage are permitted under specific conditions listed in the header comments of the source file.

## Included Libraries
- **ec_base.h**
- **erasure_code.h**
- **poly_code.h**
- **test.h**
- Standard libraries: `<stdio.h>`, `<stdlib.h>`, `<string.h>`

## Type Definitions
```c
typedef unsigned char u8;
```
This snippet defines `u8` as an alias to `unsigned char`, which is used throughout the code for byte manipulation.

## Utility Functions

### dump_u8xu8
```c
void dump_u8xu8 (unsigned char *s, int k, int m);
```
- **Description:** Prints a `k x m` matrix of bytes in hexadecimal format.
- **Parameters:**
  - `unsigned char *s`: A pointer to the byte array.
  - `int k`: Number of rows to print.
  - `int m`: Number of columns to print.

### handle_error
```c
void handle_error (int code);
```
- **Description:** Handles PAPI errors by printing an error message and terminating the program.
- **Parameters:**
  - `int code`: Error code returned from PAPI functions.

### InitPAPI
```c
int InitPAPI (void);
```
- **Description:** Initializes the PAPI library and prepares to collect performance metrics.
- **Returns:** Event set identifier.

## Test Functions

### TestPAPIRoots
```c
void TestPAPIRoots(void);
```
- **Description:** Tests the performance of finding roots using different algorithms and logs the cycle counts and instructions.
  
### TestPAPIInv
```c
void TestPAPIInv(void);
```
- **Description:** Tests the performance of matrix inversion while profiling using PAPI.

### TestPAPIbm
```c
void TestPAPIbm(void);
```
- **Description:** Tests the performance of the Berlekamp-Massey algorithm to recover key equations.

## Main Function
```c
int main (int argc, char *argv[]);
```
- **Description:** The entry point of the program. It parses command line arguments, initializes buffers, and executes various encoding and decoding performance benchmarks.
- **Parameters:**
  - `int argc`: The argument count.
  - `char *argv[]`: The argument vector.

## Command Line Arguments
- `-h`: Displays help information for using the program.
- `-k <val>`: Specifies the number of source buffers.
- `-p <val>`: Specifies the number of parity buffers.
- `-2 <val>`: If 1 is supplied, it enables AVX2 testing.

## Error Injection and Verification

### inject_errors_in_place
```c
void inject_errors_in_place (unsigned char **data, int index, int num_errors, unsigned char *error_positions, uint8_t *original_values);
```
- **Description:** Introduces errors into the data at specified positions for testing purposes.
  
### verify_correction_in_place
```c
int verify_correction_in_place (unsigned char **data, int index, int num_errors, unsigned char *error_positions, uint8_t *original_values);
```
- **Description:** Verifies whether the corrections for introduced errors are correct.
- **Returns:** `1` if verification is successful, `0` otherwise.

### test_pgz_decoder
```c
int test_pgz_decoder (int index, int m, int p, unsigned char *g_tbls, unsigned char **data, unsigned char **coding, int avx2);
```
- **Description:** Tests the ability of the decoder to correct errors injected into the data.
- **Parameters:** Various parameters including index, matrix size, tables, data buffers, etc.

## Performance Benchmarking
Performance results for various encoding and decoding operations are printed using the `BENCHMARK` macro, which records the time taken to perform specific operations.

### Example Outputs
Performance metrics such as cycles, instructions, and CPI (Cycles Per Instruction) are printed after executing tests.

## Memory Management
The code employs `malloc`, `free`, and memory alignment functions to manage dynamic memory efficiently. It checks for allocation success and handles cleanup in case of errors.

### Memory Alignment
Ensures that data buffers are aligned to cache line sizes to improve access speed, using `posix_memalign`.

## Final Notes
This document serves as a comprehensive overview of the functionality provided in the `erasure_code_perf.c` file. For deeper insights on specific functions or sections, users should refer directly to the code in conjunction with this documentation. Each function is written to perform specific tasks related to erasure coding and performance measurement, ensuring robust testing and validation methods.

---
*Documentation generated by* **[AutoCodeDocs.ai](https://autocodedocs.ai)**